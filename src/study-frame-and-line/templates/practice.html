<div id="instructions-container-one">
    <h2 id="practice-title" class="text-center bolded-blue" data-i18n="litw-study-practice"></h2>
    <div id="task_type" data-type="{{ task_type }}"></div>
    <!-- Practice starting page -->
    <div id="practice-start">
        <h3 id="instructions-one" class="text-center data-i18n=" style="margin-top: 20px;" data-i18n="litw-practice-p1"></h3>
        <div style=" display: flex; justify-content: center; align-items: center;">
            <button id="startButton" class="btn btn-primary" type="submit" onclick="startPractice()" style="margin-top: 120px;"   data-i18n="study-fl-practice-start"></button>
        </div>
    </div>
    <!-- Practice instructions page -->
    <div id="practice-instructions-look" style="display: none;">
        <h5 id="instructions-two" class="text-center data-i18n=" data-i18n="litw-practice-p2-{{task_type}}"></h5>
    </div>
    <div id="practice-instructions-respond" style="display: none;">
        <h5 id="instructions-three" class="text-center data-i18n=" data-i18n="litw-practice-p3-{{task_type}}"></h5>
        <h5 id="instructions-four" class="text-center data-i18n=" data-i18n="litw-practice-p4"></h5>
        <h5 id="instructions-five" class="text-center data-i18n=" data-i18n="litw-practice-p5"></h5>
    </div>
    <!-- Practice results page -->
    <div id="results" style="display: none;">
        <h3 id="results-one" class="text-center bolded-blue" data-i18n="litw-practice-p6"></h3>
        <h4 id="results-two" class="text-center data-i18n=" data-i18n="litw-practice-result-p1"></h4>
        <h6 id="results-three" class="text-center data-i18n=" data-i18n="litw-practice-result-p2"></h6>
        <h6 id="results-four" class="text-center data-i18n=" data-i18n="litw-practice-result-p3"></h6>
    </div>
</div>
<!-- Practice results summary page -->
<div id="practice-done" style="display: none;">
    <h4 id="practice-done-two" class="text-center data-i18n=" data-i18n="study-fl-practice-done-p1"></h4>
    <h6 id="practice-done-three" class="text-center data-i18n=" data-i18n="study-fl-practice-done-p2"></h6>
</div>
<!-- Practice trial content -->
<div id="drawing-area" style="display:flex; justify-content: center;">
    <span id="upBtn" class="bolded-blue" style="visibility: hidden; font-size: 100px; margin-top: 70px;">&#8593;</span>
    <canvas id='prompt_canvas'></canvas>
    <span id="downBtn" class="bolded-blue" style="visibility: hidden; font-size: 100px; margin-top: 70px;">&#8595;</span>
</div>
<div id="button-container" style=" display: flex; justify-content: center;">
    <button id="redoButton" class="btn btn-primary" style="visibility: hidden;  margin-top: 30px; margin-right: 15px;" onclick="rerunPractice()" data-i18n="study-fl-practice-btn-redo"></button>
    <button id="doneButton" class="btn btn-primary" style="visibility: hidden; margin-top: 30px; margin-left: 15px;" onclick="doneResponding()" data-i18n="study-fl-btn-done"></button>
    <button id="finishButton" class="btn btn-primary" style="visibility: hidden; margin-top: 30px; margin-left: 15px;" onclick="finishPractice()" data-i18n="study-fl-practice-btn-finish"></button>
</div>

<script type="text/javascript">
    let TRIAL = [{promptBoxSize: 150, promptLineLength: 50, responseBoxSize: 100}];

    function setupWindow() {
        let canvas_width = (window.innerWidth < 700) ? 300 : 600;
        let canvas_height = 300;
        LITW.study.frameline.setup_canvas(TRIAL, "prompt_canvas", canvas_width, canvas_height, "downBtn", "upBtn");
    }

    function startPractice() {
        LITW.study.frameline.start_next_trial(prompt_show_time=5000,
            prompt_callback= ()=>{
                document.getElementById("practice-start").style.display = "none";
                document.getElementById("practice-instructions-look").style.display = "block";
            },
            response_callback= ()=>{
                document.getElementById("practice-instructions-look").style.display = "none";
                document.getElementById("practice-instructions-respond").style.display = "block";
                document.getElementById("doneButton").style.visibility = "visible";
                document.getElementById("upBtn").style.visibility = "visible";
                document.getElementById("downBtn").style.visibility = "visible";
            }
        );
    }

    function rerunPractice() {
        document.getElementById("redoButton").style.visibility = "hidden";
        document.getElementById("finishButton").style.visibility = "hidden";
        document.getElementById("results").style.display = "none";
        setupWindow();
        startPractice();
    }

    function doneResponding() {
        let trial_type = document.getElementById("task_type").dataset.type;
        let trial_result = LITW.study.frameline.finish_current_trial(trial_type);
        if (trial_result) {
            LITW.study.frameline.draw_trial_result(trial_result);
        } else {
            console.error("FrameLine module could not finish the trial correctly.");
        }
        document.getElementById("upBtn").style.visibility = "hidden";
        document.getElementById("downBtn").style.visibility = "hidden";
        document.getElementById("practice-instructions-respond").style.visibility = "hidden";
        document.getElementById("results-two").textContent = `${$.i18n('study-fl-practice-results')}:
                                                              ${trial_result.error_perc}%`;
        document.getElementById("results").style.display = "block";

        document.getElementById("doneButton").style.visibility = "hidden";
        document.getElementById("redoButton").style.visibility = "visible";
        document.getElementById("finishButton").style.visibility = "visible";
    }

    function finishPractice() {
        document.getElementById("practice-title").innerText = $.i18n("study-fl-practice-done");
        document.getElementById("drawing-area").style.display = "none";
        document.getElementById("results").style.display = "none";
        document.getElementById("button-container").style.display = "none";
        document.getElementById("btn-next-page").style.display = "block";
        document.getElementById("practice-done").style.display = "block";
    }

    $(document).ready(() => {
        setupWindow();
    });
</script>